<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>histogram.histogram &mdash; histogram 2.1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="top" title="histogram 2.1.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <link rel="shortcut icon" type="image/png" href="../../_static/favicon.png" />
    <meta name="viewport" content="width=device-width,initial-scale=0.8">
    
    

  </head>
  <body role="document">
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="responsive-menu"><a href="#sidebar-anchor" title="Navigation">&#9776;</a></li>
        <li><a href="../../index.html">histogram 2.1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>
    
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for histogram.histogram</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">unicode_literals</span>
<span class="kn">from</span> <span class="nn">builtins</span> <span class="k">import</span> <span class="nb">str</span>
<span class="kn">from</span> <span class="nn">six</span> <span class="k">import</span> <span class="n">string_types</span><span class="p">,</span> <span class="n">text_type</span>

<span class="kn">import</span> <span class="nn">itertools</span> <span class="k">as</span> <span class="nn">it</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">Iterable</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">copy</span><span class="p">,</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">numbers</span> <span class="k">import</span> <span class="n">Integral</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="k">import</span> <span class="n">warn</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">optimize</span> <span class="k">as</span> <span class="n">opt</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">stats</span><span class="p">,</span> <span class="n">ndimage</span><span class="p">,</span> <span class="n">interpolate</span>
<span class="kn">from</span> <span class="nn">uncertainties</span> <span class="k">import</span> <span class="n">nominal_value</span><span class="p">,</span> <span class="n">std_dev</span><span class="p">,</span> <span class="n">ufloat</span>
<span class="kn">from</span> <span class="nn">uncertainties</span> <span class="k">import</span> <span class="n">unumpy</span> <span class="k">as</span> <span class="n">unp</span>

<span class="kn">from</span> <span class="nn">.histogram_axis</span> <span class="k">import</span> <span class="n">HistogramAxis</span>
<span class="kn">from</span> <span class="nn">.detail</span> <span class="k">import</span> <span class="n">skippable</span><span class="p">,</span> <span class="n">window</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">rc</span>

<span class="c1"># ignore divide by zero (silently create nan&#39;s)</span>
<span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Histogram"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram">[docs]</a><span class="k">class</span> <span class="nc">Histogram</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;N-dimensional histogram over a continuous range.</span>

<span class="sd">    This is a histogram where each axis is a continuous (non-discrete) range</span>
<span class="sd">    with a set number of bins. The binning does not have to be evenly spaced.</span>

<span class="sd">    Args:</span>
<span class="sd">        axes (list): List of :py:class:`HistogramAxis` or constructor</span>
<span class="sd">            parameters thereof. These are the axis definitions.</span>

<span class="sd">    Keyword Args:</span>
<span class="sd">        label (str): Label for the filled data.</span>
<span class="sd">        title (str): Title of this histogram.</span>
<span class="sd">        data (scalar array): N-dimensional array for the filled data.</span>
<span class="sd">        uncert (scalar array): N-dimensional array for the uncertainty.</span>
<span class="sd">        dtype (scalar type): Type of the data array. Input data will be</span>
<span class="sd">            converted if different.</span>

<span class="sd">    Example:</span>

<span class="sd">        Typical usage would be to fill the histogram from a sample of data. In</span>
<span class="sd">        this example, we create a 1D histogram with 100 bins from 0 to 10, and</span>
<span class="sd">        fill it with 10k samples distributed normally around 5 with a width</span>
<span class="sd">        (sigma) of 1::</span>

<span class="sd">            import numpy as np</span>
<span class="sd">            from matplotlib import pyplot</span>
<span class="sd">            from histogram import Histogram</span>

<span class="sd">            h = Histogram(100, [0, 10], &#39;x (cm)&#39;, &#39;counts&#39;, &#39;Random Distribution&#39;)</span>
<span class="sd">            h.fill(np.random.normal(5, 1, 10000))</span>
<span class="sd">            fig, ax = pyplot.subplots(figsize=(4, 2.5))</span>
<span class="sd">            fig.subplots_adjust(left=.18, bottom=.2, right=.95, top=.88)</span>
<span class="sd">            pt = ax.plothist(h, color=&#39;steelblue&#39;)</span>
<span class="sd">            pyplot.show()</span>

<span class="sd">        .. image:: images/histogram_1dnorm.png</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">axes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">label</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;label&#39;</span> <span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">title</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;title&#39;</span> <span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">data</span>   <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;data&#39;</span>  <span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">dtype</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dtype&#39;</span> <span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">uncert</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;uncert&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">axes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;you must specify at least one axis.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">skip</span><span class="p">,</span> <span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span> <span class="ow">in</span> <span class="n">skippable</span><span class="p">(</span><span class="n">window</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="n">string_types</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">arg0_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">arg0</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">arg0_array</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">object</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arg0_array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HistogramAxis</span><span class="p">(</span><span class="o">*</span><span class="n">arg0</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HistogramAxis</span><span class="p">(</span><span class="n">arg0_array</span><span class="p">,</span> <span class="n">arg1</span><span class="p">))</span>
                        <span class="n">skip</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HistogramAxis</span><span class="p">(</span><span class="n">arg0_array</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HistogramAxis</span><span class="p">(</span><span class="o">*</span><span class="n">arg0</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="n">Integral</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg2</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HistogramAxis</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">))</span>
                    <span class="n">skip</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HistogramAxis</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="n">arg1</span><span class="p">))</span>
                    <span class="n">skip</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="n">HistogramAxis</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="n">string_types</span><span class="p">)</span> <span class="ow">or</span> <span class="n">arg0</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">string_types</span><span class="p">)</span> <span class="ow">or</span> <span class="n">arg1</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="k">assert</span> <span class="n">arg2</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="n">arg1</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">string_types</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">label</span> <span class="o">=</span> <span class="n">a</span>
                        <span class="k">elif</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">title</span> <span class="o">=</span> <span class="n">a</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;bad argument list&#39;</span><span class="p">)</span>
                <span class="n">skip</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>

        <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">nbins</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">(</span><span class="n">dtype</span> <span class="ow">or</span> <span class="n">rc</span><span class="o">.</span><span class="n">fill_type</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">shape</span><span class="p">,</span> <span class="s1">&#39;Data shape must match axes.&#39;</span>

        <span class="k">if</span> <span class="n">uncert</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span> <span class="o">=</span> <span class="n">uncert</span>

    <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="sd">&quot;&quot;&quot;`list` of `HistogramAxis` objects which detail binning along the axes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="c1">### properties</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;:py:class:`numpy.ndarray` of the filled data.</span>

<span class="sd">        The indexes are in the same order as the :py:class:`HistogramAxis`</span>
<span class="sd">        objects in the list stored in :py:attr:`Histogram.axes`. One can set</span>
<span class="sd">        this directly - shape is checked and data is written &quot;in-place&quot; when</span>
<span class="sd">        possible.</span>

<span class="sd">        Here, we create a histogram and set the data directly::</span>

<span class="sd">            from scipy import stats</span>
<span class="sd">            from matplotlib import pyplot</span>
<span class="sd">            from histogram import Histogram</span>

<span class="sd">            h = Histogram(50, [0, 10])</span>

<span class="sd">            xx, = h.grid</span>
<span class="sd">            h.data = 1000 * stats.norm(5, 2).pdf(xx)</span>

<span class="sd">            fig, ax = pyplot.subplots(figsize=(4, 2.5))</span>
<span class="sd">            fig.subplots_adjust(left=.15, bottom=.2, right=.9, top=.85)</span>
<span class="sd">            pt = ax.plothist(h, color=&#39;steelblue&#39;)</span>
<span class="sd">            pyplot.show()</span>

<span class="sd">        .. image:: images/histogram_data_1dnorm.png</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="nd">@data</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_uncert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_uncert&#39;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uncert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;:py:class:`numpy.ndarray` of the absolute uncertainty.</span>

<span class="sd">        This has the same shape as :py:attr:`Histogram.data`. Under certain</span>
<span class="sd">        cases, this will be set automatically to the square-root of the data</span>
<span class="sd">        (Poisson statistics assumption).</span>

<span class="sd">        When histogramming a sample of randomly distributed data, the</span>
<span class="sd">        uncertainty of each bin is the equal to the square-root of the counts</span>
<span class="sd">        in that bin::</span>

<span class="sd">            import numpy as np</span>
<span class="sd">            from scipy import stats</span>
<span class="sd">            from numpy import random as rand</span>
<span class="sd">            from matplotlib import pyplot</span>
<span class="sd">            from histogram import Histogram</span>

<span class="sd">            rand.seed(1)</span>

<span class="sd">            h = Histogram(30, [0, 10])</span>

<span class="sd">            xx, = h.grid</span>
<span class="sd">            h.data = 1000 * stats.norm(5, 2).pdf(xx)</span>
<span class="sd">            h.data += rand.normal(0, 10, xx.shape)</span>

<span class="sd">            h.uncert = np.sqrt(h.data)</span>

<span class="sd">            fig, ax = pyplot.subplots(figsize=(4, 2.5))</span>
<span class="sd">            fig.subplots_adjust(left=.15, bottom=.2, right=.9, top=.85)</span>
<span class="sd">            pt = ax.plothist(h, style=&#39;errorbar&#39;)</span>
<span class="sd">            pyplot.show()</span>

<span class="sd">        .. image:: images/histogram_uncert_1dnorm.png</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_uncert&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

    <span class="nd">@uncert</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">uncert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">u</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_uncert</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_uncert</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_uncert</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span>

    <span class="nd">@uncert</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span> <span class="nf">uncert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_uncert</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uncert</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uncert_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The untertainty as ratios of the data&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="nd">@uncert_ratio</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">uncert_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the uncertainty by ratio of the data&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span> <span class="o">=</span> <span class="n">u</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Title of this histogram.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_title&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@title</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_title</span> <span class="o">=</span> <span class="n">text_type</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="nd">@title</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_title&#39;</span><span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_title</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Label of the filled data in this histogram</span>

<span class="sd">        This is usually something like &quot;counts&quot;.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_label&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@label</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">l</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="n">text_type</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>

    <span class="nd">@label</span><span class="o">.</span><span class="n">deleter</span>
    <span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_label&#39;</span><span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label</span>

<div class="viewcode-block" id="Histogram.__eq__"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.__eq__">[docs]</a>    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">that</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if data and axes are equal.</span>

<span class="sd">        Uncertainty, labels and titles are not considered. For complete</span>
<span class="sd">        equality, see :py:meth:`Histogram.isidentical`. For finer control of</span>
<span class="sd">        histogram comparison, consider using :py:func:`numpy.allclose()` on the</span>
<span class="sd">        data::</span>

<span class="sd">            import numpy as np</span>
<span class="sd">            from histogram import Histogram</span>

<span class="sd">            h1 = Histogram(10, (0, 10))</span>
<span class="sd">            h2 = Histogram(10, (0, 10))</span>
<span class="sd">            h3 = Histogram(10, (-10, 10))</span>

<span class="sd">            h1.data[2] = 1</span>
<span class="sd">            h2.data[2] = 1</span>
<span class="sd">            h3.data[3] = 1</span>

<span class="sd">            # checks data and axes:</span>
<span class="sd">            assert h1 == h2</span>
<span class="sd">            assert not (h1 == h3)</span>

<span class="sd">            # checks only data:</span>
<span class="sd">            assert np.allclose(h1.data, h2.data)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">that</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">aa</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="n">that</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">aa</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># histogram data shape mismatch</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">that</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span> <span class="o">==</span> <span class="n">that</span><span class="p">)</span>

<div class="viewcode-block" id="Histogram.isidentical"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.isidentical">[docs]</a>    <span class="k">def</span> <span class="nf">isidentical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">that</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if histograms are identical including uncertainty and labels.</span>

<span class="sd">        See also :py:meth:`Histogram.__eq__`.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span> <span class="o">==</span> <span class="n">that</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_uncert</span> <span class="ow">or</span> <span class="n">that</span><span class="o">.</span><span class="n">has_uncert</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">,</span> <span class="n">that</span><span class="o">.</span><span class="n">uncert</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">!=</span> <span class="n">that</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">!=</span> <span class="n">that</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">aa</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="n">that</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="o">.</span><span class="n">isidentical</span><span class="p">(</span><span class="n">aa</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<span class="c1">### non-modifying information getters</span>
<div class="viewcode-block" id="Histogram.__str__"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Breif string representation of the data.</span>

<span class="sd">        Returns the string representation of the numpy array containing the</span>
<span class="sd">        data only. Axes, uncertainty and labels are ignored.</span>

<span class="sd">        Example::</span>

<span class="sd">            from numpy import random as rand</span>
<span class="sd">            from histogram import Histogram</span>

<span class="sd">            rand.seed(1)</span>

<span class="sd">            h = Histogram(10, [0, 10])</span>
<span class="sd">            h.fill(rand.normal(5, 2, 10000))</span>
<span class="sd">            print(h)</span>

<span class="sd">        output::</span>

<span class="sd">            [ 164  428  909 1484 1915 1934 1525  873  467  175]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Complete string representation of the histogram&quot;&quot;&quot;</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;Histogram(</span><span class="si">{axes}</span><span class="s1">, </span><span class="si">{args}</span><span class="s1">)&#39;</span>
        <span class="n">axesstr</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span>
            <span class="s1">&#39;dtype&#39;</span><span class="p">:</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span> <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_uncert</span><span class="p">:</span>
            <span class="n">args</span><span class="p">[</span><span class="s1">&#39;uncert&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
        <span class="n">argsstr</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
        <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axesstr</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">argsstr</span><span class="p">)</span>

<div class="viewcode-block" id="Histogram.__call__"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.__call__">[docs]</a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">xx</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Value of histogram at a point</span>

<span class="sd">        Returns the value of the histogram at a specific point ``(x, y...)`` or</span>
<span class="sd">        array of points ``(xx, yy...)``.</span>

<span class="sd">        Args:</span>
<span class="sd">            xx (tuple of numbers or arrays): Point(s) inside the axes of this</span>
<span class="sd">                histogram.</span>

<span class="sd">        Keyword Args:</span>
<span class="sd">            overflow_value (number): Return value when the point lies outside</span>
<span class="sd">                this histogram. (default: 0)</span>

<span class="sd">        Example::</span>

<span class="sd">            from numpy import random as rand</span>
<span class="sd">            from histogram import Histogram</span>

<span class="sd">            rand.seed(1)</span>

<span class="sd">            h = Histogram(10, [0, 10])</span>
<span class="sd">            h.fill(rand.normal(5, 2, 10000))</span>
<span class="sd">            for x in [0.5, 1.5, 2.5]:</span>
<span class="sd">                print( h(x) )</span>

<span class="sd">        output::</span>

<span class="sd">            164</span>
<span class="sd">            428str(</span>
<span class="sd">            909</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">overflow_value</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;overflow_value&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="nb">bin</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;=</span> <span class="n">ax</span><span class="o">.</span><span class="n">nbins</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">overflow_value</span>
            <span class="nb">bin</span> <span class="o">+=</span> <span class="p">[</span><span class="n">b</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">bin</span><span class="p">)]</span></div>

<div class="viewcode-block" id="Histogram.asdict"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.asdict">[docs]</a>    <span class="k">def</span> <span class="nf">asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dictionary representation of this histogram.</span>

<span class="sd">        This includes uncertainty, axes, labels and title and is used to</span>
<span class="sd">        serialize the histogram to NumPy&#39;s binary format (see</span>
<span class="sd">        :py:func:`save_histogram_to_npz`).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">flat</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">asdict</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;axes:</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                    <span class="n">ret</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;axes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">asdict</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_uncert</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;uncert&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
        <span class="k">return</span> <span class="n">ret</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="Histogram.fromdict"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.fromdict">[docs]</a>    <span class="k">def</span> <span class="nf">fromdict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create new :py:class:`Histogram` from a dictionary.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;axes&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">HistogramAxis</span><span class="o">.</span><span class="n">fromdict</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span><span class="p">):</span>
                <span class="n">axdict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;edges&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">]:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;axes:</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                        <span class="n">axdict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">axdict</span><span class="p">)</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">HistogramAxis</span><span class="o">.</span><span class="n">fromdict</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;label&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Histogram</span><span class="p">(</span><span class="o">*</span><span class="n">axes</span><span class="p">,</span> <span class="o">**</span><span class="n">d</span><span class="p">)</span></div>

<span class="c1">###    dimension and shape</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dimension of this histogram (number of axes)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Shape of the histogram data</span>

<span class="sd">        This is a tuple of the number of bins in each axis ``(x, y...)``. This</span>
<span class="sd">        is the same as :py:attr:`Histogram.data.shape`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Total number of bins (size of data)</span>

<span class="sd">        This is the product of the number of bins in each axis. This is the</span>
<span class="sd">        same as :py:meth:`Histogram.data.size`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">size</span>

<span class="c1">###    axes information (bin edges and centers)</span>
<div class="viewcode-block" id="Histogram.isuniform"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.isuniform">[docs]</a>    <span class="k">def</span> <span class="nf">isuniform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">05</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mi">1</span><span class="n">e</span><span class="o">-</span><span class="mi">08</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if all axes are uniform</span>

<span class="sd">        Returns &quot;and&quot; of :py:meth:`HistogramAxis.isuniform` for each axis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="n">ax</span><span class="o">.</span><span class="n">isuniform</span><span class="p">(</span><span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">])</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Edges of each axis as a tuple</span>

<span class="sd">        Output is in the form::</span>

<span class="sd">            ( [x0, x1..], [y0, y1...] ... )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">ax</span><span class="o">.</span><span class="n">edges</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">])</span>

<div class="viewcode-block" id="Histogram.grid"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.grid">[docs]</a>    <span class="k">def</span> <span class="nf">grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Meshgrid of the.bincenters() of each axis</span>

<span class="sd">        This is a single array for 1D histograms - i.e. the bin-centers of the</span>
<span class="sd">        x-axis. For 2D histograms, this is a tuple of two 2D arrays::</span>

<span class="sd">            XX, YY = h2.grid</span>

<span class="sd">        Here, ``XX`` and ``YY`` are arrays of shape ``(xbins, ybins)``. For 1D</span>
<span class="sd">        histograms, the output is still a tuple so typically, one should expand</span>
<span class="sd">        this out with a comma::</span>

<span class="sd">            xx, = h1.grid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bincenters</span><span class="p">(),</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">centers</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">bincenters</span><span class="p">()</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="o">*</span><span class="n">centers</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Histogram.edge_grid"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.edge_grid">[docs]</a>    <span class="k">def</span> <span class="nf">edge_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Meshgrid built from the axes&#39; edges</span>

<span class="sd">        This is the same as :py:meth:`Histogram.grid` but for the edges of each</span>
<span class="sd">        axis instead of the bin centers.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">edges</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="o">*</span><span class="n">edges</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Histogram.binwidths"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.binwidths">[docs]</a>    <span class="k">def</span> <span class="nf">binwidths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Widths of all bins along each axis</span>

<span class="sd">        This will always return a tuple::</span>

<span class="sd">            dx, dy = h2.binwidths()</span>

<span class="sd">        Here, ``dx`` and ``dy`` are arrays of the widths of each bin along the</span>
<span class="sd">        `x` and `y` axes respecitively. For 1D histograms, the output is still</span>
<span class="sd">        a tuple so typically, one should expand this out with a comma::</span>

<span class="sd">            dx, = h1.binwidths()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">ax</span><span class="o">.</span><span class="n">binwidths</span><span class="p">()</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">])</span></div>

<div class="viewcode-block" id="Histogram.binwidth"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.binwidth">[docs]</a>    <span class="k">def</span> <span class="nf">binwidth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Width of a specific bin ``b`` along an axis</span>

<span class="sd">        Args:</span>
<span class="sd">            b (int): Bin index (from zero, default: 1).</span>
<span class="sd">            axis (int): Axis index (default: 0).</span>

<span class="sd">        Note:</span>

<span class="sd">            Default is the second bin (index = 1) in the first (index = 0) axis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">binwidth</span><span class="p">(</span><span class="n">b</span><span class="p">)</span></div>

<div class="viewcode-block" id="Histogram.binvolumes"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.binvolumes">[docs]</a>    <span class="k">def</span> <span class="nf">binvolumes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Volumes of each bin</span>

<span class="sd">        Volume is defined as the product of the bin-widths along each axis for the given bin. For 1D histogram, this is the same as :py:attr:`Histogram.binwidths()`. For 2D histograms, this returns a 2D array like the following where dxi is the width of the ith bin along the x-axis (first, index = 0)::</span>

<span class="sd">            [ [ dx0*dy0, dx0*dy1 ... ],</span>
<span class="sd">              [ dx1*dy0, dx1*dy1 ... ],</span>
<span class="sd">              ... ] = h2.binvolumes()</span>

<span class="sd">            h.binvolumes()[i, j] = dxi * dyj</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">widths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binwidths</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">widths</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="o">*</span><span class="n">widths</span><span class="p">))</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">overflow_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Guaranteed overflow point when filling this histogram</span>

<span class="sd">        For 1D histograms, this is a tuple of one value ``(x, )`` generated by</span>
<span class="sd">        :py:attr:`HistogramAxis.overflow_value`. For 2D histograms, this will</span>
<span class="sd">        look like ``(x, y)``.</span>

<span class="sd">        Example::</span>

<span class="sd">            from histogram import Histogram</span>

<span class="sd">            ha = Histogram(10, [0, 10])</span>
<span class="sd">            print(h)</span>

<span class="sd">            ha.fill(ha.overflow_value)</span>
<span class="sd">            print(h)</span>

<span class="sd">        Output::</span>

<span class="sd">            [0 0 0 0 0 0 0 0 0 0]</span>
<span class="sd">            [0 0 0 0 0 0 0 0 0 0]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">overflow_value</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span>

<span class="c1">###    data information (limits, sum, extent)</span>
<div class="viewcode-block" id="Histogram.sum_data"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.sum_data">[docs]</a>    <span class="k">def</span> <span class="nf">sum_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">axes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sum of bin values or sum along one or more axes.&quot;&quot;&quot;</span>
        <span class="n">all_axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">))</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">all_axes</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">axes</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_uncert</span> <span class="ow">and</span> <span class="n">axes</span> <span class="o">==</span> <span class="n">all_axes</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">ufloat</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Histogram.sum"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.sum">[docs]</a>    <span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">axes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sum of bin values or sum along one or more axes.</span>

<span class="sd">        Args:</span>

<span class="sd">            axes (tuple of integers, optional): Axes to sum over.</span>

<span class="sd">        Returns the sum over all values or sums only over specific axes and</span>
<span class="sd">        returns a new :py:class:`Histogram` with reduced dimension.</span>

<span class="sd">        Example::</span>

<span class="sd">            from histogram import Histogram</span>

<span class="sd">            h = Histogram(10, [0, 10])</span>
<span class="sd">            h.fill([1, 2, 2, 3, 3, 3, 4, 4, 4, 4])</span>

<span class="sd">            print(&#39;sum of h:&#39;, h.sum())</span>

<span class="sd">            h2 = Histogram(10, [0, 10], 10, [0, 10])</span>
<span class="sd">            h2.fill([1, 2, 2, 3, 3, 3, 4, 4, 4, 4],</span>
<span class="sd">                    [1, 1, 1, 1, 1, 1, 2, 2, 2, 2])</span>

<span class="sd">            print(&#39;h2 sum along axis 0:&#39;, h2.sum(0))</span>

<span class="sd">        Output::</span>

<span class="sd">            sum of h: 10</span>
<span class="sd">            h2 sum along axis 0: [0 6 4 0 0 0 0 0 0 0]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">))</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">all_axes</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">axes</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">axes</span> <span class="o">==</span> <span class="n">all_axes</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_data</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_uncert</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_data</span><span class="p">(</span><span class="o">*</span><span class="n">axes</span><span class="p">)</span>
                <span class="n">newdata</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                <span class="n">newuncert</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>
                <span class="n">newuncert</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">ii</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">))</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">axes</span><span class="p">))</span>
            <span class="n">newaxes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ii</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">Histogram</span><span class="p">(</span><span class="o">*</span><span class="n">newaxes</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">newdata</span><span class="p">,</span> <span class="n">uncert</span><span class="o">=</span><span class="n">newuncert</span><span class="p">,</span>
                             <span class="n">title</span><span class="o">=</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">))</span></div>

<div class="viewcode-block" id="Histogram.projection_data"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.projection_data">[docs]</a>    <span class="k">def</span> <span class="nf">projection_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Projection of the data onto an axis.&quot;&quot;&quot;</span>
        <span class="n">sumaxes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">))</span> <span class="o">-</span> <span class="p">{</span><span class="n">axis</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum_data</span><span class="p">(</span><span class="o">*</span><span class="n">sumaxes</span><span class="p">)</span></div>

<div class="viewcode-block" id="Histogram.projection"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.projection">[docs]</a>    <span class="k">def</span> <span class="nf">projection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Projection onto a single axis.&quot;&quot;&quot;</span>
        <span class="n">sumaxes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">))</span> <span class="o">-</span> <span class="p">{</span><span class="n">axis</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">*</span><span class="n">sumaxes</span><span class="p">)</span></div>

<div class="viewcode-block" id="Histogram.integral"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.integral">[docs]</a>    <span class="k">def</span> <span class="nf">integral</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Total volume-weighted sum of the histogram.&quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">binvolumes</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">nominal_value</span><span class="p">(</span><span class="n">res</span><span class="p">),</span> <span class="n">std_dev</span><span class="p">(</span><span class="n">res</span><span class="p">)</span></div>

<div class="viewcode-block" id="Histogram.min"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.min">[docs]</a>    <span class="k">def</span> <span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Minimum value of the filled data including uncertainty.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">)</span></div>

<div class="viewcode-block" id="Histogram.max"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.max">[docs]</a>    <span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Maximum value of the filled data including uncertainty.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">)</span></div>

<div class="viewcode-block" id="Histogram.mean"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.mean">[docs]</a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Mean position of the data along the axes</span>

<span class="sd">        Returns:</span>

<span class="sd">            tuple: Mean (float) along each axis: ``(xmean, ymean...)``.</span>

<span class="sd">        Bin-centers are used as the position and non-equal widths are</span>
<span class="sd">        incorporated into the weighting of the results.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">axis</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection_data</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">axis</span><span class="o">.</span><span class="n">isuniform</span><span class="p">():</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">bincenters</span><span class="p">(),</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">axis</span><span class="o">.</span><span class="n">binwidth</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bw</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">binwidths</span><span class="p">()</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">bincenters</span><span class="p">(),</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">bw</span><span class="p">)</span>
                <span class="n">w</span> <span class="o">*=</span> <span class="n">bw</span>
            <span class="n">mean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span></div>

<div class="viewcode-block" id="Histogram.var"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.var">[docs]</a>    <span class="k">def</span> <span class="nf">var</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Variance of the data along the axes</span>

<span class="sd">        Returns:</span>

<span class="sd">            tuple: Variance (float) along each axis: ``(xvar, yvar...)``.</span>

<span class="sd">        This will ignore all ``nan`` and ``inf`` values in the histogram.</span>
<span class="sd">        Bin-centers are used as the position and non-equal widths are</span>
<span class="sd">        incorporated into the weighting of the results.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">var</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">mean</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">())):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection_data</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">axis</span><span class="o">.</span><span class="n">isuniform</span><span class="p">():</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">bincenters</span><span class="p">(),</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">axis</span><span class="o">.</span><span class="n">binwidth</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bw</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">binwidths</span><span class="p">()</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">axis</span><span class="o">.</span><span class="n">bincenters</span><span class="p">(),</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">bw</span><span class="p">)</span>
                <span class="n">w</span> <span class="o">*=</span> <span class="n">bw</span>
            <span class="n">sum_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">sum_w</span>
            <span class="n">var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">sum_w</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">var</span><span class="p">)</span></div>

<div class="viewcode-block" id="Histogram.std"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.std">[docs]</a>    <span class="k">def</span> <span class="nf">std</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Standard deviation of the data along the axes</span>

<span class="sd">        Returns:</span>

<span class="sd">            tuple: Standard deviation (float) along each axis: ``(xstd,</span>
<span class="sd">            ystd...)``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">var</span> <span class="o">=</span> <span class="p">[</span><span class="n">ufloat</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">n</span><span class="p">,</span><span class="n">x</span><span class="o">.</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">()]</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">unp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">))</span></div>

<div class="viewcode-block" id="Histogram.extent"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.extent">[docs]</a>    <span class="k">def</span> <span class="nf">extent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxdim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">uncert</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extent of axes and data</span>

<span class="sd">        Returns:</span>

<span class="sd">            tuple: extent like ``(xmin, xmax, ymin ...)``.</span>

<span class="sd">        By default, this includes the uncertainty if the last dimension is the</span>
<span class="sd">        histogram&#39;s data and not an axis::</span>

<span class="sd">            [xmin, xmax, ymin, ymax, ..., min(data-uncert), max(data+uncert)]</span>

<span class="sd">        padding is given as a percent of the actual extent of the axes or data</span>
<span class="sd">        (plus uncertainty) and can be either a single floating point number or</span>
<span class="sd">        a list of length ``2 * maxdim``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">maxdim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">maxdim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[:</span><span class="n">maxdim</span><span class="p">]:</span>
            <span class="n">ext</span> <span class="o">+=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">max</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">maxdim</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">uncert</span><span class="p">:</span>
                <span class="n">ext</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ext</span> <span class="o">+=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">pad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pad</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
                <span class="n">pad</span> <span class="o">=</span> <span class="p">[</span><span class="n">pad</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">maxdim</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxdim</span><span class="p">):</span>
                <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">dim</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">ext</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">-</span> <span class="n">ext</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
                <span class="n">ext</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">-=</span> <span class="n">pad</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">*</span> <span class="n">w</span>
                <span class="n">ext</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">+=</span> <span class="n">pad</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">*</span> <span class="n">w</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span></div>

<div class="viewcode-block" id="Histogram.errorbars"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.errorbars">[docs]</a>    <span class="k">def</span> <span class="nf">errorbars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxdim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">asratio</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Bin half-widths and data uncertainties.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">maxdim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">maxdim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">ax</span><span class="o">.</span><span class="n">binwidths</span><span class="p">()</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[:</span><span class="n">maxdim</span><span class="p">]]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">maxdim</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">asratio</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">/=</span> <span class="n">ax</span><span class="o">.</span><span class="n">range</span>
            <span class="k">if</span> <span class="n">maxdim</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">:</span>
                <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="Histogram.asline"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.asline">[docs]</a>    <span class="k">def</span> <span class="nf">asline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Points describing this histogram as a line.&quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;only 1D histograms can be translated into a line.&#39;</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">edges</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

        <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">xx</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">xx</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">yy</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">yy</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">extent</span></div>

<span class="c1">### self modifying methods (set, fill)</span>
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Direct access to the filled data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Direct access to the filled data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

<div class="viewcode-block" id="Histogram.set"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">uncert</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set filled data to specific values.</span>

<span class="sd">        This will set the uncertainty to ``None`` by default and will accept a</span>
<span class="sd">        single value or an array the same shape as the data. Data will be cast</span>
<span class="sd">        to the data type already stored in the histogram.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">T</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

        <span class="k">if</span> <span class="n">uncert</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_uncert</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_uncert</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">uncert</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncert</span><span class="o">.</span><span class="n">T</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncert</span></div>

<div class="viewcode-block" id="Histogram.set_nans"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.set_nans">[docs]</a>    <span class="k">def</span> <span class="nf">set_nans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">uncert</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set all NaNs to a specific value.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_uncert</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">)]</span> <span class="o">=</span> <span class="n">uncert</span></div>

<div class="viewcode-block" id="Histogram.set_infs"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.set_infs">[docs]</a>    <span class="k">def</span> <span class="nf">set_infs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">uncert</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set all infinity values to a specific value.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_uncert</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">)]</span> <span class="o">=</span> <span class="n">uncert</span></div>

<div class="viewcode-block" id="Histogram.set_nonfinites"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.set_nonfinites">[docs]</a>    <span class="k">def</span> <span class="nf">set_nonfinites</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">uncert</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set all non-finite values to a specific value.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_uncert</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">)]</span> <span class="o">=</span> <span class="n">uncert</span></div>

<div class="viewcode-block" id="Histogram.reset"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set data to zero and uncertainty to `None`.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Histogram.fill"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.fill">[docs]</a>    <span class="k">def</span> <span class="nf">fill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fill histogram with sample data.</span>

<span class="sd">        Arguments (``\*args``) are the sample of data with optional associated</span>
<span class="sd">        weights. Weights may be a single number or an array of length `N`. The</span>
<span class="sd">        default (``None``) is equivalent to ``weights=1``. Example::</span>

<span class="sd">            from histogram import Histogram</span>

<span class="sd">            ### 1D Example</span>
<span class="sd">            h = Histogram(10, [0, 10])</span>

<span class="sd">            h.fill(1)           # single value</span>
<span class="sd">            h.fill(2, 2)         # single value with weight</span>
<span class="sd">            h.fill([3, 3, 3])     # data sample</span>
<span class="sd">            h.fill([4, 4], 2)     # data sample with constant weight</span>
<span class="sd">            h.fill([5, 5], [2, 3]) # data sample with variable weights</span>

<span class="sd">            print(h)</span>
<span class="sd">            # output:</span>
<span class="sd">            # [0 1 2 3 4 5 0 0 0 0]</span>

<span class="sd">            ### 2D Example</span>
<span class="sd">            h = Histogram(3, [0, 3], 10, [0, 10])</span>
<span class="sd">            xdata = [0, 0, 1, 1, 2]</span>
<span class="sd">            ydata = [1, 2, 3, 4, 5]</span>
<span class="sd">            weights = [1, 2, 3, 4, 5]</span>
<span class="sd">            h.fill(xdata, ydata, weights)</span>

<span class="sd">            print(h)</span>
<span class="sd">            # output:</span>
<span class="sd">            # [[0 1 2 0 0 0 0 0 0 0]</span>
<span class="sd">            #  [0 0 0 3 4 0 0 0 0 0]</span>
<span class="sd">            #  [0 0 0 0 0 5 0 0 0 0]]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">:</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="n">args</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fill_from_sample</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span></div>

<div class="viewcode-block" id="Histogram.fill_one"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.fill_one">[docs]</a>    <span class="k">def</span> <span class="nf">fill_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">wt</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fill a single data point</span>

<span class="sd">        This increments a single bin by weight ``wt``. While it is the fastest</span>
<span class="sd">        method for a single entry, it should only be used as a last resort</span>
<span class="sd">        because its at least an order of magnitude slower than</span>
<span class="sd">        :py:meth:`Histogram.fill_from_sample` when filling many entries.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pt</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span> <span class="o">&lt;</span> <span class="n">pt</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bin</span><span class="p">(</span><span class="n">pt</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">wt</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">ax</span><span class="o">.</span><span class="n">min</span> <span class="ow">or</span> <span class="n">ax</span><span class="o">.</span><span class="n">max</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="n">b</span> <span class="o">+=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">bin</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">b</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">wt</span></div>

<div class="viewcode-block" id="Histogram.fill_from_sample"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.fill_from_sample">[docs]</a>    <span class="k">def</span> <span class="nf">fill_from_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fill histogram from sample of data</span>

<span class="sd">        This fills the histogram from sample with shape `(D, N)` array where `D`</span>
<span class="sd">        is the dimension of the histogram and `N` is the number of points to</span>
<span class="sd">        fill. The optional ``weights`` may be a single number or an array of</span>
<span class="sd">        length `N`. The default (``None``) is equivalent to ``weights = 1``.</span>

<span class="sd">        This is the primary work-horse of the :py:class:`Histogram` class and</span>
<span class="sd">        should be favored, along with the wrapper method</span>
<span class="sd">        :py:meth:`Histogram.fill` over :py:meth:`Histogram.fill_one`.</span>

<span class="sd">        Example::</span>

<span class="sd">            from numpy import random as rand</span>
<span class="sd">            from matplotlib import pyplot</span>
<span class="sd">            from histogram import Histogram</span>

<span class="sd">            rand.seed(1)</span>

<span class="sd">            ### 1D Example</span>
<span class="sd">            h = Histogram(10, [0, 10], 30, [0, 10])</span>

<span class="sd">            h.fill_from_sample(rand.normal(5, 1, (2, 20000)))</span>

<span class="sd">            fig, ax = pyplot.subplots(figsize=(4, 2.5))</span>
<span class="sd">            pt = ax.plothist(h)</span>
<span class="sd">            fig.tight_layout()</span>

<span class="sd">            pyplot.show()</span>

<span class="sd">        .. image:: images/histogram_fill_from_sample.png</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
        <span class="n">wt</span> <span class="o">=</span> <span class="n">weights</span>
        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
                <span class="n">wt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">sample</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">))</span>
                <span class="n">wt</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">weights</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogramdd</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">wt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">+=</span> <span class="n">h</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span></div>

<span class="c1">### operations</span>
    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a complete copy of this histogram.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a complete copy of this histogram.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<div class="viewcode-block" id="Histogram.copy"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copy this histogram optionally changing dtype and labels.&quot;&quot;&quot;</span>
        <span class="n">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span>
        <span class="n">newhist</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">)</span>

        <span class="n">newhist</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">newhist</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newhist</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">newhist</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">))</span>
        <span class="n">newhist</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_uncert</span><span class="p">:</span>
            <span class="n">newhist</span><span class="o">.</span><span class="n">_uncert</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_uncert</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">newhist</span></div>

<div class="viewcode-block" id="Histogram.__iadd__"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.__iadd__">[docs]</a>    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">that</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;In-place addition.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">that</span><span class="p">,</span> <span class="n">Histogram</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_uncert</span> <span class="ow">or</span> <span class="n">that</span><span class="o">.</span><span class="n">has_uncert</span><span class="p">:</span>
                <span class="n">self_data</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">)</span>
                <span class="n">that_data</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">that</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">that</span><span class="o">.</span><span class="n">uncert</span><span class="p">)</span>
                <span class="n">self_data</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">+=</span> <span class="n">that_data</span><span class="o">.</span><span class="n">T</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">self_data</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">self_data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">+=</span> <span class="n">that</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">T</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">self_data</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">)</span>
            <span class="n">self_data</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">that</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">self_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">self_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Histogram.__radd__"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.__radd__">[docs]</a>    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">that</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Commuting addition.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">that</span></div>

<div class="viewcode-block" id="Histogram.__add__"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.__add__">[docs]</a>    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">that</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Addition.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">that</span><span class="p">,</span> <span class="n">Histogram</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">&lt;</span> <span class="n">that</span><span class="o">.</span><span class="n">dim</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">that</span> <span class="o">+</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">that</span><span class="p">,</span> <span class="n">Histogram</span><span class="p">):</span>
                <span class="n">that_dtype</span> <span class="o">=</span> <span class="n">that</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">that_dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">that</span><span class="p">))</span>
            <span class="n">copy_dtype</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_uncert</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">that</span><span class="p">,</span> <span class="n">Histogram</span><span class="p">)</span> <span class="ow">and</span>
                                   <span class="n">that</span><span class="o">.</span><span class="n">has_uncert</span><span class="p">):</span>
                <span class="n">copy_dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">that_dtype</span><span class="p">:</span>
                <span class="n">inttypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="n">inttypes</span><span class="p">)</span> <span class="ow">and</span> \
                   <span class="p">(</span><span class="n">that_dtype</span> <span class="ow">in</span> <span class="n">inttypes</span><span class="p">):</span>
                    <span class="n">copy_dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">copy_dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">copy_dtype</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="n">that</span>
            <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="Histogram.__isub__"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.__isub__">[docs]</a>    <span class="k">def</span> <span class="nf">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">that</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;In-place subtraction.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">that</span><span class="p">,</span> <span class="n">Histogram</span><span class="p">):</span>
            <span class="n">self_data</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">)</span>
            <span class="n">that_data</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">that</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">that</span><span class="o">.</span><span class="n">uncert</span><span class="p">)</span>
            <span class="n">self_data</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">-=</span> <span class="n">that_data</span><span class="o">.</span><span class="n">T</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">self_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">self_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">self_data</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">)</span>
            <span class="n">self_data</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">that</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">self_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">self_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Histogram.__rsub__"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.__rsub__">[docs]</a>    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">that</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Commuting subtraction.&quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">that</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">_uncert</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">ret</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">_uncert</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">that</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ret</span> <span class="o">-=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="Histogram.__sub__"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.__sub__">[docs]</a>    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">that</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Subtraction.&quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">-=</span> <span class="n">that</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="Histogram.__imul__"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.__imul__">[docs]</a>    <span class="k">def</span> <span class="nf">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">that</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;In-place multiplication.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">that</span><span class="p">,</span> <span class="n">Histogram</span><span class="p">):</span>
            <span class="n">self_data</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">)</span>
            <span class="n">that_data</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">that</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">that</span><span class="o">.</span><span class="n">uncert</span><span class="p">)</span>
            <span class="n">self_data</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">*=</span> <span class="n">that_data</span><span class="o">.</span><span class="n">T</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">self_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">self_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">self_data</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">)</span>
            <span class="n">self_data</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">that</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">self_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">self_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Histogram.__rmul__"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.__rmul__">[docs]</a>    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">that</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Commuting mulitplication.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">that</span></div>

<div class="viewcode-block" id="Histogram.__mul__"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.__mul__">[docs]</a>    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">that</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Multiplication.&quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">*=</span> <span class="n">that</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="Histogram.__itruediv__"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.__itruediv__">[docs]</a>    <span class="k">def</span> <span class="nf">__itruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">that</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;In-place (true) division.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">that</span><span class="p">,</span> <span class="n">Histogram</span><span class="p">):</span>
            <span class="n">infs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">that</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">nans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">infs</span>
            <span class="n">ninfs</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">infs</span>
            <span class="n">sel</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="n">infs</span> <span class="o">|</span> <span class="n">nans</span><span class="p">)</span>
            <span class="n">self_data</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sel</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">[</span><span class="n">sel</span><span class="p">])</span>
            <span class="n">that_data</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="n">that</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sel</span><span class="p">],</span> <span class="n">that</span><span class="o">.</span><span class="n">uncert</span><span class="p">[</span><span class="n">sel</span><span class="p">])</span>
            <span class="n">self_data</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">/=</span> <span class="n">that_data</span><span class="o">.</span><span class="n">T</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">self_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">self_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">infs</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">ninfs</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">nans</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">[</span><span class="n">infs</span> <span class="o">|</span> <span class="n">nans</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">self_data</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">)</span>
            <span class="n">self_data</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">that</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">self_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">self_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Histogram.__rtruediv__"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.__rtruediv__">[docs]</a>    <span class="k">def</span> <span class="nf">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">that</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Commuting (true) division.</span>

<span class="sd">            that = 1.</span>
<span class="sd">            hret = that / hself</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">that</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">_uncert</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">ret</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">_uncert</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">that</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ret</span> <span class="o">/=</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="Histogram.__truediv__"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.__truediv__">[docs]</a>    <span class="k">def</span> <span class="nf">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">that</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Division.&quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">/=</span> <span class="n">that</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<span class="c1">### interpolating and smoothing</span>
<div class="viewcode-block" id="Histogram.interpolate_nonfinites"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.interpolate_nonfinites">[docs]</a>    <span class="k">def</span> <span class="nf">interpolate_nonfinites</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Replace non-finite bins with interpolated values.</span>

<span class="sd">        Keyword Args:</span>

<span class="sd">            method (str): passed directly to</span>
<span class="sd">                :py:func:`scipy.interpolate.griddata` and controls the method</span>
<span class="sd">                of interpolation used.</span>
<span class="sd">            **kwargs: Passed directly to :py:func:`scipy.interpolate.griddata`.</span>

<span class="sd">        This modifies the histogram, changing the data in-place. Bins are</span>
<span class="sd">        considered non-finite if the filled value or the uncertainty is ``nan``</span>
<span class="sd">        or ``inf``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">Integral</span><span class="p">):</span>
            <span class="n">finite</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_uncert</span><span class="p">:</span>
                <span class="n">finite</span> <span class="o">&amp;=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">finite</span><span class="p">):</span>
                <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
                <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">g</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">griddata</span><span class="p">(</span>
                    <span class="n">points</span><span class="p">[</span><span class="n">finite</span><span class="p">],</span>
                    <span class="n">values</span><span class="p">[</span><span class="n">finite</span><span class="p">],</span>
                    <span class="n">points</span><span class="p">,</span>
                    <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_uncert</span><span class="p">:</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">griddata</span><span class="p">(</span>
                        <span class="n">points</span><span class="p">[</span><span class="n">finite</span><span class="p">],</span>
                        <span class="n">values</span><span class="p">[</span><span class="n">finite</span><span class="p">],</span>
                        <span class="n">points</span><span class="p">,</span>
                        <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span></div>

<div class="viewcode-block" id="Histogram.smooth"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.smooth">[docs]</a>    <span class="k">def</span> <span class="nf">smooth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Smooth the histogram using a Gaussian filter.</span>

<span class="sd">        Keyword Args:</span>

<span class="sd">            weight (float [0, 1]): Linear weighting for Gaussian filter. A</span>
<span class="sd">                value of 1 will replace the data with the actual result from</span>
<span class="sd">                :py:func:`scipy.ndimage.filters.gaussian_filter`.</span>
<span class="sd">            sigma (float or sequence of floats): Passed directly to</span>
<span class="sd">                :py:func:`scipy.ndimage.filters.gaussian_filter`.</span>
<span class="sd">            mode (str): Passed directly to</span>
<span class="sd">                :py:func:`scipy.ndimage.filters.gaussian_filter`.</span>
<span class="sd">            **kwargs: Passed directly to</span>
<span class="sd">                :py:func:`scipy.ndimage.filters.gaussian_filter`.</span>

<span class="sd">        All non-finite bins are filled using</span>
<span class="sd">        :py:meth:`Histogram.interpolate_nans` before the Gaussian filter is</span>
<span class="sd">        applied. If the underlying data is of integral type, it will be</span>
<span class="sd">        converted to `numpy.float64` before the filter is applied.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolate_nonfinites</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">Integral</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">Zf</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">gaussian_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
                                             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span>   <span class="o">=</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">Zf</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">weight</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_uncert</span><span class="p">:</span>
            <span class="n">Uf</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">gaussian_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span>
                                                 <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">Uf</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">weight</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span></div>

<span class="c1">### slicing and shape changing</span>
<div class="viewcode-block" id="Histogram.slices_data"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.slices_data">[docs]</a>    <span class="k">def</span> <span class="nf">slices_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Iterable over the data along specified axis.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">rollaxis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span></div>

<div class="viewcode-block" id="Histogram.slices_uncert"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.slices_uncert">[docs]</a>    <span class="k">def</span> <span class="nf">slices_uncert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Iterable over the uncertainty along specified axis.&quot;&quot;&quot;</span>
        <span class="n">uncert</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">rollaxis</span><span class="p">(</span><span class="n">uncert</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span></div>

<div class="viewcode-block" id="Histogram.slices"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.slices">[docs]</a>    <span class="k">def</span> <span class="nf">slices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generator of histograms along specified axis.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_uncert</span><span class="p">:</span>
            <span class="n">uncert_slices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slices_uncert</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">uncert_slices</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">nbins</span>
        <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">u</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slices_data</span><span class="p">(</span><span class="n">axis</span><span class="p">),</span> <span class="n">uncert_slices</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Histogram</span><span class="p">(</span>
                <span class="o">*</span><span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">axis</span><span class="p">],</span>
                <span class="n">data</span><span class="o">=</span><span class="n">d</span><span class="p">,</span>
                <span class="n">uncert</span><span class="o">=</span><span class="n">u</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span></div>

<div class="viewcode-block" id="Histogram.rebin"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.rebin">[docs]</a>    <span class="k">def</span> <span class="nf">rebin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">snap</span><span class="o">=</span><span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new histogram with merged bins along an axis.</span>

<span class="sd">        Keyword Args:</span>
<span class="sd">            nbins (int): Number of bins to merge.</span>
<span class="sd">            axis (int): Axis along which to merge bins.</span>
<span class="sd">            snap (str): Controls edge behavior if `nbins` does not evenly</span>
<span class="sd">                divide the number of bins in this `axis`.</span>
<span class="sd">            clip (bool): Wether or not to include the non-uniform bin in the</span>
<span class="sd">                case that `bins` does not evenly divide the number of bins in</span>
<span class="sd">                this `axis`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">axnew</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">mergebins</span><span class="p">(</span><span class="n">nbins</span><span class="p">,</span> <span class="n">snap</span><span class="p">,</span> <span class="n">clip</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">axis</span> <span class="k">else</span> <span class="n">ax</span>
                 <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_uncert</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">uarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rollaxis</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">d</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">nbins</span><span class="p">)</span>
        <span class="n">shp</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">,</span> <span class="n">nbins</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">shp</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">clip</span><span class="p">:</span>
                <span class="n">shp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">shp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">r</span>
                <span class="n">zeros</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nbins</span> <span class="o">-</span> <span class="n">r</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
                <span class="k">if</span> <span class="n">snap</span> <span class="o">==</span> <span class="s1">&#39;low&#39;</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">zeros</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">zeros</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">shp</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rollaxis</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_uncert</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">nominal_values</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">uncert</span> <span class="o">=</span> <span class="n">unp</span><span class="o">.</span><span class="n">std_devs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">x</span>
            <span class="n">uncert</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">Histogram</span><span class="p">(</span><span class="o">*</span><span class="n">axnew</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">uncert</span><span class="o">=</span><span class="n">uncert</span><span class="p">)</span></div>

<div class="viewcode-block" id="Histogram.cut"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.cut">[docs]</a>    <span class="k">def</span> <span class="nf">cut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Truncate a histogram along one or more axes.</span>

<span class="sd">        To cut (truncate) a one dimensional histogram from 0 to 5,</span>
<span class="sd">        each of the following are valid. This will also cut an</span>
<span class="sd">        ND histogram along the first (x) axis::</span>

<span class="sd">            hcut = h.cut(0, 5)</span>
<span class="sd">            hcut = h.cut((0, 5))</span>
<span class="sd">            hcut = h.cut(0, 5, axis=0)</span>
<span class="sd">            hcut = h.cut((0, 5), axis=0)</span>

<span class="sd">        To cut along the second (y) axis, you can do the following::</span>

<span class="sd">            hcut = h.cut(0, 5, axis=1)</span>
<span class="sd">            hcut = h.cut((0, 5), axis=1)</span>
<span class="sd">            hcut = h.cut(None, (0, 5))</span>
<span class="sd">            hcut = h.cut((None, None), (0, 5))</span>

<span class="sd">        To cut only on one side, `None` may be used to indicate</span>
<span class="sd">        +/- infinity. This makes a lower-bound type cut at 0::</span>

<span class="sd">            hcut = h.cut(0, None)</span>

<span class="sd">        Finally, to cut on multiple dimensions at once, the cut</span>
<span class="sd">        ranges can be strung together. These examples cut</span>
<span class="sd">        along the first axis (x) from 0 to 5 and along the second</span>
<span class="sd">        axis (y) from 1 to 6::</span>

<span class="sd">            hcut = h.cut(0, 5, 1, 6)</span>
<span class="sd">            hcut = h.cut((0, 5), (1, 6))</span>

<span class="sd">        The first example above is useful for cutting 2D histogram</span>
<span class="sd">        using extent lists as used in other libraries like</span>
<span class="sd">        matplotlib::</span>

<span class="sd">            hcut = h.cut(*ax.extent())</span>

<span class="sd">        where, for example, `ax.extent()` returns the extent in</span>
<span class="sd">        the form::</span>

<span class="sd">            [xmin, xmax, ymin, ymax]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;axis&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
                <span class="n">rng</span> <span class="o">+=</span> <span class="n">a</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">rng</span> <span class="o">+=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rng</span> <span class="o">+=</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">rng</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span>
        <span class="n">rng</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">inrng</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span>
            <span class="n">rng</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)]</span>
            <span class="n">rng</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">inrng</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rng</span><span class="p">)</span>

        <span class="n">newaxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">newdata</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_uncert</span><span class="p">:</span>
            <span class="n">newuncert</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newuncert</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="p">)):</span>
            <span class="n">xlow</span><span class="p">,</span> <span class="n">xhigh</span> <span class="o">=</span> <span class="n">r</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">xlow</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">xhigh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">newaxes</span> <span class="o">+=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">copy</span><span class="p">()]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">xlow</span><span class="p">,</span> <span class="n">xhigh</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="s1">&#39;nearest&#39;</span><span class="p">))</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">m</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">newaxes</span> <span class="o">+=</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>
                <span class="n">newdata</span> <span class="o">=</span> <span class="n">newdata</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">newuncert</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">newuncert</span> <span class="o">=</span> <span class="n">newuncert</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Histogram</span><span class="p">(</span><span class="o">*</span><span class="n">newaxes</span><span class="p">,</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">newdata</span><span class="p">,</span>
            <span class="n">uncert</span> <span class="o">=</span> <span class="n">newuncert</span><span class="p">,</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)),</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)))</span></div>

<div class="viewcode-block" id="Histogram.occupancy"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.occupancy">[docs]</a>    <span class="k">def</span> <span class="nf">occupancy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Histogram the filled data of this histogram</span>

<span class="sd">        Returns a new histogram showing the occupancy of the data. This is</span>
<span class="sd">        effectively histograming the data points, ignoring the axes and</span>
<span class="sd">        uncertanties.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">limits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">limits</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="o">~</span><span class="n">nans</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="bp">self</span><span class="p">[</span><span class="o">~</span><span class="n">nans</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">limits</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">fill_from_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="o">~</span><span class="n">nans</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<span class="c1">### curve fitting</span>
<div class="viewcode-block" id="Histogram.fit"><a class="viewcode-back" href="../../histogram.html#histogram.Histogram.fit">[docs]</a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fcn</span><span class="p">,</span> <span class="n">p0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fit a function to the histogram</span>

<span class="sd">        Fits the function ``fcn`` to the histogram, returning estimated</span>
<span class="sd">        parameters, their covariance matrix and a tuple containing the</span>
<span class="sd">        specified test result (chi-square test is default).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">test</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;chisquare&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">uncert</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;uncert&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncert</span><span class="p">)</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;sel&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">))</span>

        <span class="k">if</span> <span class="s1">&#39;sigma&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;&quot;sigma&quot; keyword not valid, use &quot;uncert&quot;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;absolute_sigma&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;&quot;absolute_sigma&quot; ignored (considered True).&#39;</span><span class="p">)</span>

        <span class="c1"># initial parameters</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;p0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;p0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>

        <span class="n">npar</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;p0&#39;</span><span class="p">])</span>

        <span class="c1"># data selection</span>
        <span class="n">sel</span> <span class="o">&amp;=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="n">xx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xx</span><span class="p">:</span>
            <span class="n">sel</span> <span class="o">&amp;=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">uncert</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># consider only finite uncertainties</span>
            <span class="n">sel</span> <span class="o">&amp;=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">uncert</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">uncert</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">uncert</span><span class="p">):</span>
                <span class="c1"># uncertainties are the same value</span>
                <span class="n">uncert</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># throw out uncertainties equal to zero</span>
                <span class="n">sel</span> <span class="o">&amp;=</span> <span class="o">~</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">uncert</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">npar</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Not enough data.&#39;</span><span class="p">)</span>

        <span class="c1"># make selection on grid</span>
        <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xx</span><span class="p">))</span>

        <span class="c1"># make selection on data at grid points</span>
        <span class="n">yy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="c1"># make selection on uncertainty</span>
        <span class="k">if</span> <span class="n">uncert</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uncert</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;absolute_sigma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># perform the fit</span>
        <span class="n">pfit</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">curve_fit</span><span class="p">(</span><span class="n">fcn</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pcov</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">pcov</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Bad fit.&#39;</span><span class="p">)</span>

        <span class="c1">### perform goodness of fit test</span>
        <span class="k">if</span> <span class="n">test</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">N</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">npar</span>
            <span class="n">ndf</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">m</span>
            <span class="n">yyfit</span> <span class="o">=</span> <span class="n">fcn</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="o">*</span><span class="n">pfit</span><span class="p">)</span>
            <span class="n">dyy</span> <span class="o">=</span> <span class="n">yy</span> <span class="o">-</span> <span class="n">yyfit</span>

            <span class="c1"># nchar is the minimum number of characters</span>
            <span class="c1"># used to disambiguate goodness of fit tests.</span>
            <span class="c1"># at the moment, one letter is sufficient.</span>
            <span class="n">nchar</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">test</span><span class="p">[:</span><span class="n">nchar</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;kstest&#39;</span><span class="p">[:</span><span class="n">nchar</span><span class="p">]:</span>
                <span class="c1"># two-sided Kolmogorov-Smirov test</span>
                <span class="n">D</span><span class="p">,</span> <span class="n">pval</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">kstest</span><span class="p">(</span><span class="n">dyy</span><span class="p">,</span>
                            <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dyy</span><span class="o">.</span><span class="n">std</span><span class="p">())</span><span class="o">.</span><span class="n">cdf</span><span class="p">)</span>
                <span class="n">ptest</span> <span class="o">=</span> <span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">pval</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">test</span><span class="p">[:</span><span class="n">nchar</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;shapiro&#39;</span><span class="p">[:</span><span class="n">nchar</span><span class="p">]:</span>
                <span class="c1"># Shapiro-Wilk test</span>
                <span class="n">W</span><span class="p">,</span> <span class="n">pval</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">shapiro</span><span class="p">(</span><span class="n">dyy</span><span class="p">)</span>
                <span class="n">ptest</span> <span class="o">=</span> <span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">pval</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># test[:nchar] == &#39;chisquare&#39;[:nchar]:</span>
                <span class="c1"># simple Chi-squared test</span>
                <span class="n">chisq</span><span class="p">,</span> <span class="n">pval</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">chisquare</span><span class="p">(</span><span class="n">yy</span><span class="p">,</span> <span class="n">yyfit</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pfit</span><span class="p">))</span>
                <span class="n">ptest</span> <span class="o">=</span> <span class="p">(</span><span class="n">chisq</span><span class="o">/</span><span class="n">ndf</span><span class="p">,</span> <span class="n">pval</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">pfit</span><span class="p">,</span> <span class="n">pcov</span><span class="p">,</span> <span class="n">ptest</span>

        <span class="k">return</span> <span class="n">pfit</span><span class="p">,</span> <span class="n">pcov</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
    <a id="sidebar-anchor"></a>
    

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2017, John T. Goetz.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.5.
    </div>
  </body>
</html>